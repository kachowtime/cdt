---
# File: deploy_file_server.yml
#
# Purpose
# This playbook configures a basic Windows Server 2022 file server.
# It installs the File Server role, creates a directory structure,
# publishes an SMB share, and applies local NTFS permissions.
#
# Scope
# This playbook is intended to run on a standalone Windows Server.
# It does not require Active Directory.
# Permissions are local only.
#
# Intended Use
# This is a baseline configuration.
# Domain integration, auditing, and vulnerabilities will be added later.
#
# Environment
# Windows Server 2022
# WinRM enabled
# Local Administrator credentials


- name: Baseline Windows 2022 File Server
  hosts: windows_file_server
  gather_facts: yes

  tasks:

    # Task 1 -- Install the Windows File Server role.
    - name: Install File Server role
      ansible.windows.win_feature:
        name: FS-FileServer
        state: present

    # Task 2 -- Create the root directory used to store file shares.
    - name: Create file share root directory
      ansible.windows.win_file:
        path: "D:\\FileShares"
        state: directory

    # Task 3 -- Create a public share folder.
    - name: Create Public share folder
      ansible.windows.win_file:
        path: "D:\\FileShares\\Public"
        state: directory

    # Task 4 -- Create an SMB share named Public.
    - name: Create SMB Public share
      ansible.windows.win_share:
        name: "Public"
        path: "D:\\FileShares\\Public"
        description: "Public company file share"
        state: present

    # Task 5 -- Apply NTFS permissions to the Public folder.
    - name: Set NTFS permissions on Public share
      ansible.windows.win_acl:
        path: "D:\\FileShares\\Public"
        user: "Users"
        permission: "Modify"
        state: present
